<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Printing...</title>
  <link rel="stylesheet" href="theme.css">
  <link rel="stylesheet" href="Kiosk Css/printing.css">
  <style>
    body {
      background: #161d27;
      color: #fff;
      font-family: 'Lilita One', 'Arial', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }
    .loading-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin-top: 40px;
    }
    .loader {
      border: 8px solid #222b3a;
      border-top: 8px solid #ffbe3b;
      border-radius: 50%;
      width: 64px;
      height: 64px;
      animation: spin 1s linear infinite;
      margin-bottom: 24px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg);}
      100% { transform: rotate(360deg);}
    }
    .printing-text {
      font-size: 2rem;
      letter-spacing: 1px;
      color: #ffbe3b;
      margin-bottom: 32px;
    }
    .receipt-preview {
      background: #fff;
      color: #222b3a;
      padding: 24px 32px;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.12);
      font-family: 'IM FELL GreatPrimer', serif;
      width: 320px;
      margin-bottom: 40px;
    }
    .receipt-preview h2 {
      text-align: center;
      font-size: 1.5rem;
      margin-bottom: 8px;
      font-family: 'Lilita One', sans-serif;
      color: #161d27;
      letter-spacing: 1px;
    }
    .receipt-line {
      font-size: 1.1rem;
      margin: 8px 0;
      display: flex;
      justify-content: space-between;
      border-bottom: 1px dashed #ddd;
      padding-bottom: 3px;
    }
    .receipt-label {
      font-weight: bold;
      color: #3a465e;
    }
    .receipt-value {
      text-align: right;
    }
    .receipt-thankyou {
      text-align: center;
      margin-top: 18px;
      font-size: 1rem;
      color: #666;
      letter-spacing: 1px;
    }
    @media (max-width: 400px) {
      .receipt-preview {
        width: 90vw;
        padding: 12px 6vw;
      }
    }
  </style>
</head>
<body>
  <div class="loading-container">
    <div class="loader"></div>
    <div class="printing-text">Printing...</div>
    <div class="receipt-preview" id="receiptPreview">
      <!-- Receipt preview will be inserted here by JS -->
    </div>
  </div>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDZsj-cL_T_BuLtAz5bkqsw-edZXnumwe0",
      authDomain: "iot-web-58054.firebaseapp.com",
      databaseURL: "https://iot-web-58054-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "iot-web-58054",
      storageBucket: "iot-web-58054.appspot.com",
      messagingSenderId: "949884902967",
      appId: "1:949884902967:web:6e7f78c7cd0fa1484629b2",
      measurementId: "G-5C79490N66"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Get review details from localStorage
    const businessName = localStorage.getItem("businessName") || "N/A";
    const product = localStorage.getItem("product") || "N/A";
    const tagline = localStorage.getItem("tagline") || "N/A";
    const funding = localStorage.getItem("funding") || "N/A";
    const purpose = localStorage.getItem("purpose") || "N/A";
    const deviceName = "POS58DE487"; // Your printer name

    // Render receipt preview
    document.getElementById("receiptPreview").innerHTML = `
      <h2>ScaleUp Kiosk Receipt</h2>
      <div class="receipt-line"><span class="receipt-label">Business Name:</span> <span class="receipt-value">${businessName}</span></div>
      <div class="receipt-line"><span class="receipt-label">Product:</span> <span class="receipt-value">${product}</span></div>
      <div class="receipt-line"><span class="receipt-label">Tagline:</span> <span class="receipt-value">${tagline}</span></div>
      <div class="receipt-line"><span class="receipt-label">Funding Goal:</span> <span class="receipt-value">₱${funding}</span></div>
      <div class="receipt-line"><span class="receipt-label">Purpose:</span> <span class="receipt-value">${purpose}</span></div>
      <div class="receipt-thankyou">Thank you for using ScaleUp!</div>
    `;

    // ESC/POS friendly format for the thermal printer
    function formatForPrinter() {
      let lines = [
        "==============================",
        "        ScaleUp Kiosk         ",
        "==============================",
        `Business Name: ${businessName}`,
        `Product:      ${product}`,
        `Tagline:      ${tagline}`,
        `Funding Goal: ₱${funding}`,
        `Purpose:      ${purpose}`,
        "",
        "   Thank You for Using ScaleUp!",
        "=============================="
      ];
      return lines.join('\n');
    }

    // Send print request to Firebase
    function sendPrintRequest() {
      const requestRef = db.ref('print_requests').push();
      return requestRef.set({
        deviceName: deviceName,
        text: formatForPrinter(),
        timestamp: Date.now()
      });
    }

    // Immediately send print request, then redirect after 8 seconds
    sendPrintRequest().finally(() => {
      setTimeout(function() {
        window.location.href = "screen8.html";
      }, 8000);
    });
  </script>
</body>
</html><!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Printing...</title>
  <link rel="stylesheet" href="theme.css">
  <link rel="stylesheet" href="Kiosk Css/printing.css">
  <style>
    body {
      background: #161d27;
      color: #fff;
      font-family: 'Lilita One', 'Arial', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }
    .loading-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin-top: 40px;
    }
    .loader {
      border: 8px solid #222b3a;
      border-top: 8px solid #ffbe3b;
      border-radius: 50%;
      width: 64px;
      height: 64px;
      animation: spin 1s linear infinite;
      margin-bottom: 24px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg);}
      100% { transform: rotate(360deg);}
    }
    .printing-text {
      font-size: 2rem;
      letter-spacing: 1px;
      color: #ffbe3b;
      margin-bottom: 32px;
    }
    .receipt-preview {
      background: #fff;
      color: #222b3a;
      padding: 24px 32px;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.12);
      font-family: 'IM FELL GreatPrimer', serif;
      width: 320px;
      margin-bottom: 40px;
    }
    .receipt-preview h2 {
      text-align: center;
      font-size: 1.5rem;
      margin-bottom: 8px;
      font-family: 'Lilita One', sans-serif;
      color: #161d27;
      letter-spacing: 1px;
    }
    .receipt-line {
      font-size: 1.1rem;
      margin: 8px 0;
      display: flex;
      justify-content: space-between;
      border-bottom: 1px dashed #ddd;
      padding-bottom: 3px;
    }
    .receipt-label {
      font-weight: bold;
      color: #3a465e;
    }
    .receipt-value {
      text-align: right;
    }
    .receipt-thankyou {
      text-align: center;
      margin-top: 18px;
      font-size: 1rem;
      color: #666;
      letter-spacing: 1px;
    }
    @media (max-width: 400px) {
      .receipt-preview {
        width: 90vw;
        padding: 12px 6vw;
      }
    }
  </style>
</head>
<body>
  <div class="loading-container">
    <div class="loader"></div>
    <div class="printing-text">Printing...</div>
    <div class="receipt-preview" id="receiptPreview">
      <!-- Receipt preview will be inserted here by JS -->
    </div>
  </div>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDZsj-cL_T_BuLtAz5bkqsw-edZXnumwe0",
      authDomain: "iot-web-58054.firebaseapp.com",
      databaseURL: "https://iot-web-58054-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "iot-web-58054",
      storageBucket: "iot-web-58054.appspot.com",
      messagingSenderId: "949884902967",
      appId: "1:949884902967:web:6e7f78c7cd0fa1484629b2",
      measurementId: "G-5C79490N66"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Get review details from localStorage
    const businessName = localStorage.getItem("businessName") || "N/A";
    const product = localStorage.getItem("product") || "N/A";
    const tagline = localStorage.getItem("tagline") || "N/A";
    const funding = localStorage.getItem("funding") || "N/A";
    const purpose = localStorage.getItem("purpose") || "N/A";
    const deviceName = "POS58DE487"; // Your printer name

    // Render receipt preview
    document.getElementById("receiptPreview").innerHTML = `
      <h2>ScaleUp Kiosk Receipt</h2>
      <div class="receipt-line"><span class="receipt-label">Business Name:</span> <span class="receipt-value">${businessName}</span></div>
      <div class="receipt-line"><span class="receipt-label">Product:</span> <span class="receipt-value">${product}</span></div>
      <div class="receipt-line"><span class="receipt-label">Tagline:</span> <span class="receipt-value">${tagline}</span></div>
      <div class="receipt-line"><span class="receipt-label">Funding Goal:</span> <span class="receipt-value">₱${funding}</span></div>
      <div class="receipt-line"><span class="receipt-label">Purpose:</span> <span class="receipt-value">${purpose}</span></div>
      <div class="receipt-thankyou">Thank you for using ScaleUp!</div>
    `;

    // ESC/POS friendly format for the thermal printer
    function formatForPrinter() {
      let lines = [
        "==============================",
        "        ScaleUp Kiosk         ",
        "==============================",
        `Business Name: ${businessName}`,
        `Product:      ${product}`,
        `Tagline:      ${tagline}`,
        `Funding Goal: ₱${funding}`,
        `Purpose:      ${purpose}`,
        "",
        "   Thank You for Using ScaleUp!",
        "=============================="
      ];
      return lines.join('\n');
    }

    // Send print request to Firebase
    function sendPrintRequest() {
      const requestRef = db.ref('print_requests').push();
      return requestRef.set({
        deviceName: deviceName,
        text: formatForPrinter(),
        timestamp: Date.now()
      });
    }

    // Immediately send print request, then redirect after 8 seconds
    sendPrintRequest().finally(() => {
      setTimeout(function() {
        window.location.href = "screen8.html";
      }, 8000);
    });
  </script>
</body>
</html>